<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Historial</title>

  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="css/styles.css" />

  <style>
    body {
      background-color: #f8fafc;
      color: #0f172a;
    }

    header,
    nav {
      background-color: #ffffff;
      border-color: #e2e8f0;
    }

    .dark-mode {
      background-color: #000000 !important;
      color: #ffffff !important;
    }

    .dark-mode header,
    .dark-mode nav {
      background-color: #0c0f1a !important;
      border-color: #334155 !important;
    }

    /* Menú lateral en modo oscuro */
    .dark-mode #side-menu {
      background-color: #020617 !important;
      color: #e5e7eb !important;
    }
    .dark-mode #side-menu .border-b {
      border-color: #334155 !important;
    }
    .dark-mode #side-menu a,
    .dark-mode #side-menu button {
      color: #e5e7eb !important;
    }
    .dark-mode #side-menu a:hover,
    .dark-mode #side-menu button:hover {
      color: #22c55e !important;
    }
    .dark-mode #side-menu svg {
      color: #e5e7eb !important;
    }
    .dark-mode #side-menu .text-red-600,
    .dark-mode #side-menu .text-red-600 span {
      color: #fca5a5 !important;
    }

    /* Tarjetas de historial */
    .history-card {
      background-color: #ffffff;
      border-color: #e5e7eb;
    }
    .dark-mode .history-card {
      background-color: #020617;
      border-color: #1f2937;
    }
    .dark-mode #bottom-nav {
  background-color: #0c0f1a !important;
  border-color: #334155 !important;
}

.dark-mode #bottom-nav a {
  color: #e5e7eb !important;
}

.dark-mode #bottom-nav a.text-green-600 {
  color: #22c55e !important;
}

.dark-mode #bottom-nav svg {
  color: #e5e7eb !important;
}

  </style>
</head>
<body class="bg-gray-50">

  <!-- Sprite para iconos -->
  <svg xmlns="http://www.w3.org/2000/svg" style="display:none">
    <symbol id="icon-home" viewBox="0 0 24 24">
      <path d="M12 3 3 10h2v9h5v-6h4v6h5v-9h2z" />
    </symbol>
    <symbol id="icon-map" viewBox="0 0 24 24">
      <path d="M9 3 4 5v16l5-2 6 2 5-2V3l-5 2-6-2z" />
    </symbol>
    <symbol id="icon-history" viewBox="0 0 24 24">
      <path d="M13 3a9 9 0 1 0 8.94 8H20A7 7 0 1 1 13 5V3zm-1 4v6h5v-2h-3V7h-2z"/>
    </symbol>
    <symbol id="icon-settings" viewBox="0 0 24 24">
      <path d="M19.14 12.94c.04-.31.06-.63.06-.94s-.02-.63-.06-.94l2.03-1.58a.5.5 0 0 0 .12-.64l-1.92-3.32a.5.5 0 0 0-.61-.22l-2.39.96a7.14 7.14 0 0 0-1.63-.94L14.4 2.5a.5.5 0 0 0-.49-.5h-3.82a.5.5 0 0 0-.49.5l-.36 2.82a7.14 7.14 0 0 0-1.63.94l-2.39-.96a.5.5 0 0 0-.61.22L2.7 8.86a.5.5 0 0 0 .12.64l2.03 1.58c-.04.31-.06.63-.06.94s.02.63.06.94L2.82 14.54a.5.5 0 0 0-.12.64l1.92 3.32c.13.22.39.31.61.22l2.39-.96c.5.38 1.05.7 1.63.94l.36 2.82c.03.25.24.44.49.44h3.82c.25 0 .46-.19.49-.44l.36-2.82c.58-.24 1.13-.56 1.63-.94l2.39.96c.23.09.48 0 .61-.22l1.92-3.32a.5.5 0 0 0-.12-.64l-2.03-1.58zM12 15a3 3 0 1 1 0-6 3 3 0 0 1 0 6z"/>
    </symbol>
    <symbol id="icon-support" viewBox="0 0 24 24">
      <circle cx="12" cy="7" r="3" />
      <path d="M6 20v-1a4 4 0 0 1 4-4h4a4 4 0 0 1 4 4v1" />
      <path d="M4 9h2v4H4zM18 9h2v4h-2z" />
    </symbol>
    <symbol id="icon-logout" viewBox="0 0 24 24">
      <path d="M9 4h3a2 2 0 0 1 2 2v3h-2V6H9v12h3v-3h2v3a2 2 0 0 1-2 2H9a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2z" />
      <path d="M14 12h-3v-2h3V7l5 5-5 5v-3z" />
    </symbol>
  </svg>

  <!-- HEADER -->
  <header
    id="header"
    class="bg-white border-b border-gray-200 sticky top-0 z-30 flex items-center justify-between px-4 py-4"
  >
    <!-- Botón hamburguesa -->
    <button
      class="p-2 mr-2 rounded hover:bg-gray-100"
      aria-label="Abrir menú de navegación"
      onclick="openSideMenu()"
    >
      <svg class="w-6 h-6" viewBox="0 0 24 24" fill="none" stroke="currentColor">
        <path d="M4 7h16M4 12h16M4 17h16" stroke-width="2" stroke-linecap="round"/>
      </svg>
    </button>

    <h1 class="text-xl flex-1">
      <span class="text-green-600"> AssistGo </span>
    </h1>
  </header>

  <!-- Overlay -->
  <div
    id="side-menu-overlay"
    class="fixed inset-0 bg-black/40 z-40 hidden"
    onclick="closeSideMenu()"
  ></div>

  <!-- Menú lateral -->
  <aside
    id="side-menu"
    class="fixed top-0 left-0 h-full w-64 bg-white shadow-lg z-50 -translate-x-full transform transition-transform duration-200"
    aria-label="Menú de navegación"
  >
    <div class="p-4 border-b">
      <h2 class="text-lg font-semibold">Menú de navegación</h2>
      <p class="text-sm text-gray-500">Seleccione una opción para navegar</p>
    </div>

    <nav class="p-4 space-y-6">
      <!-- Inicio -->
      <a
        href="home.html"
        class="flex items-center gap-3 text-gray-800 hover:text-green-600"
        onclick="closeSideMenu()"
      >
        <svg class="w-5 h-5" viewBox="0 0 24 24" fill="currentColor">
          <use href="#icon-home" />
        </svg>
        <span>Inicio</span>
      </a>

      <!-- Ver mapa -->
      <a
        href="map.html"
        class="flex items-center gap-3 text-gray-800 hover:text-green-600"
        onclick="closeSideMenu()"
      >
        <svg class="w-5 h-5" viewBox="0 0 24 24" fill="currentColor">
          <use href="#icon-map" />
        </svg>
        <span>Ver mapa</span>
      </a>

      <!-- Historial -->
      <a
        href="history.html"
        class="flex items-center gap-3 text-gray-800 hover:text-green-600"
        onclick="closeSideMenu()"
      >
        <svg class="w-5 h-5" viewBox="0 0 24 24" fill="currentColor">
          <use href="#icon-history" />
        </svg>
        <span>Historial</span>
      </a>

      <!-- Soporte -->
      <a
        href="support.html"
        class="flex items-center gap-3 text-gray-800 hover:text-green-600"
        onclick="closeSideMenu()"
      >
        <svg class="w-5 h-5" viewBox="0 0 24 24" fill="currentColor">
          <use href="#icon-support" />
        </svg>
        <span>Soporte</span>
      </a>

      <!-- Switch modo oscuro -->
      <div class="flex items-center justify-between gap-3 text-gray-800">
        <div class="flex items-center gap-2">
          <svg class="w-5 h-5" viewBox="0 0 24 24" fill="currentColor">
            <use href="#icon-settings" />
          </svg>
          <span>Modo oscuro</span>
        </div>
        <label class="relative inline-flex items-center cursor-pointer">
          <input type="checkbox" id="darkModeSwitch" class="sr-only peer" />
          <div
            class="w-10 h-5 bg-gray-300 rounded-full peer peer-checked:bg-green-500 transition-colors"
          ></div>
          <span
            class="absolute left-1 top-1 w-3 h-3 bg-white rounded-full shadow transform peer-checked:translate-x-5 transition-transform"
          ></span>
        </label>
      </div>

      <!-- Cerrar sesión -->
      <button
        type="button"
        class="flex items-center gap-3 text-red-600 hover:text-red-700 w-full text-left"
        onclick="logout(); closeSideMenu();"
      >
        <svg class="w-5 h-5" viewBox="0 0 24 24" fill="currentColor">
          <use href="#icon-logout" />
        </svg>
        <span>Cerrar sesión</span>
      </button>
    </nav>
  </aside>

  <!-- CONTENIDO PRINCIPAL -->
  <main class="p-6 max-w-md mx-auto">
    <h2 class="text-lg font-semibold mb-2">Historial de viajes</h2>
    <p id="empty-msg" class="text-gray-600 mb-4">
      Aún no hay viajes guardados. Cuando confirmes un viaje en el mapa, aparecerá aquí.
    </p>

    <div id="history-list" class="space-y-3"></div>

    <button
      id="clear-history-btn"
      type="button"
      class="mt-6 w-full bg-red-600 text-white text-sm font-medium py-2.5 rounded-lg hover:bg-red-700 hidden"
      onclick="clearHistory()"
    >
      Eliminar historial de viajes
    </button>
  </main>

  <!-- SCRIPTS -->
  <script>
    function toggleDarkMode() {
      const body = document.body;
      const enable = !body.classList.contains("dark-mode");

      body.classList.toggle("dark-mode", enable);
      localStorage.setItem("dark-mode", enable ? "on" : "off");

      const switchEl = document.getElementById("darkModeSwitch");
      if (switchEl) {
        switchEl.checked = enable;
      }
    }

    function logout() {
      localStorage.removeItem("isAuthenticated");
      window.location.href = "index.html";
    }

    function openSideMenu() {
      const menu = document.getElementById("side-menu");
      const overlay = document.getElementById("side-menu-overlay");
      if (!menu || !overlay) return;
      menu.classList.remove("-translate-x-full");
      overlay.classList.remove("hidden");
    }

    function closeSideMenu() {
      const menu = document.getElementById("side-menu");
      const overlay = document.getElementById("side-menu-overlay");
      if (!menu || !overlay) return;
      menu.classList.add("-translate-x-full");
      overlay.classList.add("hidden");
    }

    // Renderizar historial
    function renderHistory() {
      const listEl = document.getElementById("history-list");
      const emptyMsg = document.getElementById("empty-msg");
      const clearBtn = document.getElementById("clear-history-btn");

      let trips = [];
      try {
        trips = JSON.parse(localStorage.getItem("tripHistory") || "[]");
      } catch (e) {
        trips = [];
      }

      listEl.innerHTML = "";

      if (!trips.length) {
        emptyMsg.classList.remove("hidden");
        clearBtn.classList.add("hidden");
        return;
      }

      emptyMsg.classList.add("hidden");
      clearBtn.classList.remove("hidden");

      trips
        .slice()
        .reverse() // últimos arriba
        .forEach((trip) => {
          const card = document.createElement("div");
          card.className =
            "history-card border rounded-lg px-4 py-3 text-sm";

          const date = trip.date
            ? new Date(trip.date).toLocaleString()
            : "Fecha desconocida";

          const accessibilityMap = {
            wheelchair: "Silla de ruedas",
            ramp: "Vehículo con rampa",
            assistance: "Asistencia para subir/bajar",
            companion: "Espacio extra para acompañante",
          };

          const supportLabel =
            accessibilityMap[trip.accessibility] || "Sin especificar";

          card.innerHTML = `
            <div class="flex items-center justify-between mb-1">
              <span class="font-medium">Origen:</span>
              <span>${trip.origin || "No especificado"}</span>
            </div>
            <div class="flex items-center justify-between mb-1">
              <span class="font-medium">Destino:</span>
              <span>${trip.destination || "No especificado"}</span>
            </div>
            <div class="flex items-center justify-between mb-1">
              <span class="font-medium">Apoyo:</span>
              <span>${supportLabel}</span>
            </div>
            <p class="text-xs text-gray-500 mt-1">Registrado: ${date}</p>
          `;
          listEl.appendChild(card);
        });
    }

    function clearHistory() {
      localStorage.removeItem("tripHistory");
      renderHistory();
    }

    document.addEventListener("DOMContentLoaded", () => {
      // auth
      if (localStorage.getItem("isAuthenticated") !== "true") {
        window.location.href = "index.html";
        return;
      }

      // dark mode
      const isDark = localStorage.getItem("dark-mode") === "on";
      if (isDark) {
        document.body.classList.add("dark-mode");
      }
      const switchEl = document.getElementById("darkModeSwitch");
      if (switchEl) {
        switchEl.checked = isDark;
        switchEl.addEventListener("change", toggleDarkMode);
      }

      // pintar historial
      renderHistory();
    });
  </script>

    <!-- FOOTER / BOTTOM NAV -->
    <nav
    id="bottom-nav"
    class="fixed bottom-0 left-0 right-0 bg-white border-t border-gray-200 z-50"
  >
    <div class="flex items-center justify-around py-2">
      
      <!-- Inicio -->
      <a
        href="home.html"
        class="flex flex-col items-center gap-1 h-auto py-3 px-4 text-xs text-green-600"
      >
        <svg class="w-5 h-5" viewBox="0 0 24 24" fill="currentColor">
          <use href="#icon-home" />
        </svg>
        <span>Inicio</span>
      </a>

      <!-- Historial (activado) -->
      <a
        href="history.html"
        class="flex flex-col items-center gap-1 h-auto py-3 px-4 text-xs text-green-600"
      >
        <svg class="w-5 h-5" viewBox="0 0 24 24" fill="currentColor">
          <use href="#icon-history" />
        </svg>
        <span>Historial</span>
      </a>

    </div>
  </nav>

</body>
</html>
